###   gsl
file(
    COPY
    "${CMAKE_CURRENT_SOURCE_DIR}/gsl/include"
    DESTINATION "${CMAKE_CURRENT_SOURCE_DIR}"
)

###   googletest
if(EXA_BUILD_TESTS)
    set(gtest_force_shared_crt ON)
    add_subdirectory(googletest)
    file(
        COPY
        "${CMAKE_CURRENT_SOURCE_DIR}/googletest/googletest/include"
        DESTINATION "${CMAKE_CURRENT_SOURCE_DIR}"
    )
    file(
        COPY
        "${CMAKE_CURRENT_SOURCE_DIR}/googletest/googlemock/include"
        DESTINATION "${CMAKE_CURRENT_SOURCE_DIR}"
    )
endif()

###   cryptopp
file(GLOB_RECURSE CRYPTOPP_INCLUDES
     LIST_DIRECTORIES false
     "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/*.h")
file(
    COPY
    ${CRYPTOPP_INCLUDES}
    DESTINATION "${CMAKE_CURRENT_SOURCE_DIR}/include/cryptopp"
)

if(EXA_BUILD_TESTS)
    if(WIN32)
        set(
            CRYPTOPP_SOURCES
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/3way.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/adler32.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/algebra.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/algparam.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/arc4.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/aria.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/aria-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ariatab.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/asn.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/authenc.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/base32.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/base64.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/basecode.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/bfinit.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/blake2.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/blake2-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/blowfish.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/blumshub.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/camellia.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cast.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/casts.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cbcmac.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ccm.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/chacha.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/channels.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cmac.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cpu.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/crc.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/crc-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cryptlib.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/default.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/des.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/dessp.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/dh.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/dh2.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/dll.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/dsa.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/eax.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ec2n.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/eccrypto.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ecp.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/elgamal.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/emsa2.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/eprecomp.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/esign.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/files.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/filters.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/fips140.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/fipstest.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gcm.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gcm-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gf256.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gf2_32.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gf2n.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gfpcrypt.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gost.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/gzip.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/hex.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/hmac.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/hrtimer.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ida.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/idea.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/integer.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/iterhash.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/kalyna.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/kalynatab.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/keccak.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/luc.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/mars.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/marss.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/md2.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/md4.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/md5.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/misc.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/modes.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/mqueue.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/mqv.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/nbtheory.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/network.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/oaep.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/osrng.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/padlkrng.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/panama.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/pch.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/pkcspad.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/poly1305.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/polynomi.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/pssr.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/pubkey.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/queue.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rabin.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/randpool.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rc2.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rc5.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rc6.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rdrand.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rdtables.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rijndael.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rijndael-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ripemd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rng.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rsa.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rw.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/safer.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/salsa.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/scrypt.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/seal.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/seed.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/serpent.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sha.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sha-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sha3.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/shacal2.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/shacal2-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/shark.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sharkbox.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/simon.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/simon-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/simple.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/skipjack.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sm3.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sm4.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/speck.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/speck-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/socketft.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sosemanuk.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/square.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/squaretb.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/sse-simd.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/strciphr.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/tea.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/tftables.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/threefish.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/tiger.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/tigertab.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/trdlocal.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/ttmac.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/tweetnacl.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/twofish.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/vmac.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/wait.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/wake.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/whrlpool.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/winpipes.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/xtr.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/xtrcrypt.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/zdeflate.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/zinflate.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/zlib.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/rdrand.asm"
        )
    else()
        aux_source_directory(
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp"
            CRYPTOPP_SOURCES
        )
        list(
            FILTER CRYPTOPP_SOURCES
            EXCLUDE REGEX "cryptlib\.cpp|cpu\.cpp|integer\.cpp|pch\.cpp|simple\.cpp|winpipes\.cpp|cryptlib_bds\.cpp"
        )
        list(
            FILTER CRYPTOPP_SOURCES
            EXCLUDE REGEX "adhoc\.cpp|test\.cpp|bench1\.cpp|bench2\.cpp|validat0\.cpp|validat1\.cpp|validat2\.cpp|validat3\.cpp|validat4\.cpp|datatest\.cpp|regtest1\.cpp|regtest2\.cpp|regtest3\.cpp|dlltest\.cpp|fipsalgt\.cpp"
        )
        set(
            CRYPTOPP_SOURCES
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cryptlib.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/cpu.cpp"
            "${CMAKE_CURRENT_SOURCE_DIR}/cryptopp/integer.cpp"
            ${CRYPTOPP_SOURCES}
        )
    endif()

    add_library(
        cryptopp
        STATIC
        ${CRYPTOPP_SOURCES}
    )
endif()
